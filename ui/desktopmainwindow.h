#ifndef DESKTOPMAINWINDOW_H
#define DESKTOPMAINWINDOW_H

#include "builtin/window/settings_window/cores/SettingsPack.h"
#include "ui/appwidget.h"
#include <QMainWindow>
QT_BEGIN_NAMESPACE
namespace Ui {
class DesktopMainWindow;
}
QT_END_NAMESPACE

class QGridLayout;
class QLabel;
class DesktopToast;
class ApplicationWrapper;
class QTimer;
class QStackedWidget;
class DownDockWidget;
class AppCardWidget;
class WallPaperEngine;
class SettingsWindow;
class AppWidgetsSettingsInfoPack;

/**
 * @brief DesktopMainWindow is the main frontend window of the application.
 * For beginners, this is the starting point to understand the UI details.
 */
class DesktopMainWindow : public QMainWindow {
    Q_OBJECT

public:
    friend class PageFactory;
    friend class WallPaperEngine;
	/**
	 * @brief Construct a new Desktop Main Window object
     *
     * @param parent
	 */
    explicit DesktopMainWindow(QWidget* parent = nullptr);
	/**
	 * @brief Destroy the Desktop Main Window object
     *
	 */
    ~DesktopMainWindow();

    /**
     * @brief Show a toast message on the main window
     * @param message Message to display
     */
    void showToast(const QString& message);

    /**
     * @brief Get pointer to DesktopToast handler
     * @return DesktopToast instance
     */
    DesktopToast* desktop_toast() const { return toast; }

    /**
     * @brief Get the global DownDockWidget instance
     * @return DownDockWidget instance
     */
    DownDockWidget* downDockWidget() const;

    /**
     * @brief Slide to the next page in UI
     */
    void to_next_page();

    /**
     * @brief Slide to the previous page in UI
     */
    void to_prev_page();

    /**
     * @brief Install a remote application wrapper
     * @param wrapper Pointer to ApplicationWrapper to install
     */
    void install_remote_appwrapper(ApplicationWrapper* wrapper) { app_wrapper << wrapper; }

    /**
     * @brief Get the QStackedWidget used for page sliding
     * @return QStackedWidget pointer
     */
    QStackedWidget* stackedWidget() const;

    /**
     * @brief Perform initialization after main window is shown
     */
    void post_show();

public slots:
    /**
     * @brief Handle status changes of applications (like errors)
     * @param status Current app status
     */
    void handle_app_status(AppWidget::AppStatus status);

    /**
     * @brief open_settings_window catches the signals of open_settings
     */
    void open_settings_window();

    /**
     * @brief process_set_appwidgets_config
     * @param info infos
     */
    void process_set_appwidgets_config(const AppWidgetsSettingsInfoPack& info);

signals:
    /**
     * @brief Signal emitted when app cards require initialization
     */
    void deptach_app_cards_init();

protected:
	/**
	 * @brief mouse press sessions
     *
     * @param event
	 */
    void mousePressEvent(QMouseEvent* event) override;
    /**
	 * @brief mouse release sessions
     *
     * @param event
	 */
    void mouseReleaseEvent(QMouseEvent* event) override;
    /**
	 * @brief resize sessions
     *
     * @param event
	 */
    void resizeEvent(QResizeEvent* event) override;

private:
    Ui::DesktopMainWindow* ui; ///< UI pointer generated by Qt Designer
    DesktopToast* toast; ///< Toast message widget
    QList<ApplicationWrapper*> app_wrapper; ///< List of application wrappers
    QList<AppWidget*> app_widgets; ///< List of app widgets

    struct {
        QPoint press; ///< Mouse press position
        QPoint release; ///< Mouse release position
    } records; ///< Used for swipe gesture detection

    QList<AppCardWidget*> app_cards; ///< List of application card widgets
    WallPaperEngine* wallpaper_engine; ///< wallpaper handler

    SettingsWindow* settingsWindow; ///< windows contains settings
    /**
     * @brief Additional UI setup after ui->setupUi()
     */
    void post_setupui();

    /**
     * @brief Setup default and internal applications
     */
    void setup_apps();

    /**
     * @brief Setup default dock widgets with pre-installed apps
     */
    void setup_default_dock();

    /**
     * @brief Trigger initialization of app cards (usually connected to signal deptach_app_cards_init)
     */
    void invoke_appcards_init();
    /**
     * @brief centralWidget get the centralWidget for WallPaperEngine
     */
    QWidget* centralWidget();
};

#endif // DESKTOPMAINWINDOW_H
